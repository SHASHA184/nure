# Звіт з Лабораторної роботи №3
## Програмна реалізація хеш-функцій

**Студент:** [Ваше ім'я]
**Група:** [Ваша група]
**Курс:** Безпека програмного забезпечення та даних
**Університет:** НУРЕ

---

## 1. Мета роботи

Ознайомитись з можливостями криптографічних хеш-функцій при організації контроля цілісності цифрових об'єктів та отримати навички їх використання.

## 2. Завдання

1. ✅ Розробити свою хеш-функцію, яка повертає 2, 4, або 8 біт
2. ✅ Забезпечити зміну ≥30% бітів результату при зміні будь-якого байту
3. ✅ Створити три документа (Word, вихідний код, зображення)
4. ✅ Обчислити дайджест повідомлення для кожного файлу
5. ✅ Створити колізії - нові документи з тим самим дайджестом
6. ✅ Реалізувати програму автоматичної генерації колізій

## 3. Теоретичні відомості

### Хеш-функція
Хеш-функція - це обчислювально ефективна функція, що відображає двійковий рядок довільної довжини в двійковий рядок фіксованої довжини (дайджест).

### Криптографічна хеш-функція
Має три основні властивості:
- **Односпрямованість** - неможливо відновити вхідні дані за хешем
- **Свобода від колізій** - складно знайти два повідомлення з однаковим хешем
- **Повне перемішування** - зміна одного біта змінює ~50% бітів хешу

### Колізія
Колізія - це ситуація, коли два різні повідомлення мають однаковий хеш.

## 4. Опис реалізації

### 4.1 Хеш-функція

Реалізовано власну хеш-функцію з наступними характеристиками:

```python
def custom_hash(data: bytes, bit_length: int = 8) -> int:
    # Ініціалізація стану
    # Множинні раунди перемішування:
    # - XOR операції з позицією
    # - Множення на прості числа
    # - Побітові обертання
    # - Нелінійні перетворення
    # Фінальне перемішування
```

**Особливості реалізації:**
- 5 раундів перемішування для кожного байту
- Використання простих чисел (3, 11, 31, 37)
- Побітові обертання для кращого розподілу
- Фінальні раунди для забезпечення avalanche effect

### 4.2 Обробка файлів

Підтримуються три типи файлів:
- **Документи:** .docx, .doc
- **Код:** .py, .js, .java, .cpp, .c, .go, .cs, .txt
- **Зображення:** .png, .jpg, .jpeg, .gif, .bmp

### 4.3 Генерація колізій

Колізії створюються шляхом зміни метаданих файлів:

| Тип файлу | Метод генерації колізії |
|-----------|------------------------|
| Word документ (.docx) | Зміна властивостей: comments, subject, keywords |
| Зображення (.png) | Додавання EXIF метаданих: Comment, Author, Software |
| Вихідний код (.py) | Додавання невидимих коментарів у кінці файлу |

**Важливо:** Всі зміни невидимі при звичайному перегляді файлу!

## 5. Результати виконання

### 5.1 Тестові файли

| Файл | Тип | Розмір (байт) |
|------|-----|---------------|
| document.docx | Документ | 37,160 |
| source_code.py | Код | 728 |
| image.png | Зображення | 4,725 |

### 5.2 Обчислені хеші

#### 2-бітні хеші:
| Файл | Хеш (дес.) | Хеш (бін.) |
|------|------------|------------|
| document.docx | 2 | 10 |
| source_code.py | 2 | 10 |
| image.png | 0 | 00 |

#### 4-бітні хеші:
| Файл | Хеш (дес.) | Хеш (бін.) |
|------|------------|------------|
| document.docx | 5 | 0101 |
| source_code.py | 7 | 0111 |
| image.png | 2 | 0010 |

#### 8-бітні хеші:
| Файл | Хеш (дес.) | Хеш (бін.) |
|------|------------|------------|
| document.docx | 218 | 11011010 |
| source_code.py | 34 | 00100010 |
| image.png | 4 | 00000100 |

### 5.3 Тест властивості перемішування (Avalanche Effect)

Тестування на файлі `source_code.py` (728 байт, 200 тестів):

| Розмір хешу | % зміни бітів | Вимога | Результат |
|-------------|---------------|---------|-----------|
| 2 біти | 51.50% | ≥30% | ✅ ПРОЙДЕНО |
| 4 біти | 49.12% | ≥30% | ✅ ПРОЙДЕНО |
| 8 біт | 51.69% | ≥30% | ✅ ПРОЙДЕНО |

**Висновок:** Хеш-функція задовольняє вимогу про зміну не менше 30% бітів результату при зміні будь-якого байту вхідних даних. Фактично змінюється ~50% бітів, що близько до ідеального значення.

### 5.4 Створені колізії

#### source_code.py → source_code_collision.py
- **Оригінал:** 728 байт, хеш = 2 (10)
- **Колізія:** 740 байт, хеш = 2 (10)
- **Метод:** Додано коментар `#  ` (9 спроб)
- **Статус:** ✅ Успішна колізія

#### document.docx → document_collision.docx
- **Оригінал:** 37,160 байт, хеш = 2 (10)
- **Колізія:** 37,157 байт, хеш = 2 (10)
- **Метод:** Змінено властивість comments
- **Статус:** ✅ Успішна колізія

#### image.png → image_collision.png
- **Оригінал:** 4,725 байт, хеш = 0 (00)
- **Колізія:** 4,785 байт, хеш = 0 (00)
- **Метод:** Додано PNG метадані
- **Статус:** ✅ Успішна колізія

### 5.5 Ефективність генерації колізій

Для 2-бітного хешу (4 можливі значення):
- **Середня кількість спроб:** 1-9
- **Максимальна кількість спроб:** 5000
- **Успішність:** 100% (3 з 3 файлів)

**Пояснення:** 2-бітний хеш має лише 4 можливі значення (00, 01, 10, 11), тому колізії знаходяться дуже швидко.

## 6. Приклади використання

### Обчислення хешу:
```bash
python src/main.py hash test_files/document.docx --bits 8
```

### Створення колізії:
```bash
python src/main.py collision test_files/source_code.py --bits 2 --verify
```

### Тестування avalanche effect:
```bash
python src/main.py avalanche test_files/source_code.py --num-tests 200
```

### Порівняння файлів:
```bash
python src/main.py compare test_files/source_code.py test_files/source_code_collision.py --bits 2
```

## 7. Висновки

1. **Реалізовано власну хеш-функцію** з підтримкою різних розмірів вихідного значення (2, 4, 8 біт). Функція використовує множинні раунди перемішування для забезпечення криптографічних властивостей.

2. **Досягнуто високу якість перемішування:** При зміні будь-якого байту вхідних даних змінюється ~50% бітів хешу, що перевищує вимогу в 30% та близько до теоретичного ідеалу.

3. **Підтверджено вразливість малих хешів:** Для 2-бітного хешу колізії знаходяться за 1-10 спроб, що демонструє важливість використання достатньо великих хеш-значень у реальних системах.

4. **Реалізовано "невидиму" генерацію колізій:** Зміни в метаданих файлів не помітні при звичайному перегляді, що демонструє можливість непомітної підміни файлів при використанні слабких хеш-функцій.

5. **Практичне застосування:** Програма може використовуватись для демонстрації принципів роботи хеш-функцій, контролю цілісності файлів, та навчальних цілей з вивчення криптографії.

6. **Обмеження:** Реалізована хеш-функція призначена для навчальних цілей і не повинна використовуватись у реальних системах безпеки. Для промислового використання слід застосовувати стандартні алгоритми (SHA-256, SHA-3, BLAKE3).

## 8. Контрольні питання

1. **Поняття хеш-функції** - Функція, що перетворює дані довільної довжини у значення фіксованої довжини.

2. **Поняття криптографічної хеш-функції** - Хеш-функція з властивостями односпрямованості, свободи від колізій та повного перемішування.

3. **Поняття колізії** - Ситуація, коли два різні повідомлення мають однаковий хеш.

4. **Властивості односпрямованості і повного перемішування:**
   - Односпрямованість: неможливо відновити дані за хешем
   - Перемішування: зміна 1 біта змінює ~50% бітів хешу

5. **Використання при контролі цілісності:** Зберігаємо еталонний хеш, потім порівнюємо з хешем поточних даних. Якщо співпадають - дані цілісні.

---

**Дата виконання:** 10 листопада 2025
**Підпис студента:** _______________
